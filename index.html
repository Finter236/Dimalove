<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Heart Animation</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            background-color: black;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
        }
        canvas {
            position: absolute;
        }
    </style>
</head>
<body>
<audio id="bg-music" autoplay loop>
    <source src="https://finter236.github.io/Dimalove/kishlak-rzhavy.mp3" type="audio/mpeg">
</audio>
<canvas id="heartCanvas"></canvas>

<script>
    const canvas = document.getElementById("heartCanvas");
    const ctx = canvas.getContext("2d");
    const particles = [];
    let flicker = false;

    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;

    const heartPoints = [];
    const textPoints = [];

    function heartShape(x, y, size) {
        let points = [];
        for (let i = 0; i < Math.PI * 2; i += 0.05) {
            let px = size * (16 * Math.pow(Math.sin(i), 3)) + x;
            let py = -size * (13 * Math.cos(i) - 5 * Math.cos(2 * i) - 2 * Math.cos(3 * i) - Math.cos(4 * i)) + y;
            points.push({ x: px, y: py });
        }
        return points;
    }

    function generateParticles() {
        let heart = heartShape(canvas.width / 2 + 20, canvas.height / 2, 12);
        heartPoints.push(...heart);

        let textX = canvas.width / 2 - 20;
        let textY = canvas.height / 2;
        textPoints.push({ x: textX, y: textY });

        for (let i = 0; i < 600; i++) {
            let target = heartPoints[Math.floor(Math.random() * heartPoints.length)];
            particles.push({
                x: Math.random() * canvas.width,
                y: Math.random() * canvas.height,
                targetX: target.x,
                targetY: target.y,
                color: "white",
                reached: false
            });
        }
    }

    function updateParticles() {
        particles.forEach(p => {
            if (!p.reached) {
                p.x += (p.targetX - p.x) * 0.05;
                p.y += (p.targetY - p.y) * 0.05;
                if (Math.abs(p.x - p.targetX) < 1 && Math.abs(p.y - p.targetY) < 1) {
                    p.reached = true;
                }
            } else {
                p.color = flicker ? "pink" : "white";
            }
        });
    }

    function drawParticles() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        particles.forEach(p => {
            ctx.fillStyle = p.color;
            ctx.beginPath();
            ctx.arc(p.x, p.y, 3, 0, Math.PI * 2);
            ctx.fill();
        });

        ctx.fillStyle = "red";
        ctx.font = "80px Arial";
        ctx.fillText("42", textPoints[0].x, textPoints[0].y);
    }

    function animate() {
        updateParticles();
        drawParticles();
        requestAnimationFrame(animate);
    }

    generateParticles();
    animate();

    setInterval(() => {
        flicker = !flicker;
    }, 1000);
</script>
</body>
</html>
